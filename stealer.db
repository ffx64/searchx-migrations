CREATE TABLE file_logs (
    id SERIAL PRIMARY KEY,                           -- Identificador único do arquivo de log
    file_name VARCHAR(255) NOT NULL,                  -- Nome do arquivo
    file_size BIGINT NOT NULL,                        -- Tamanho do arquivo em bytes
    file_hash CHAR(64) NOT NULL,                      -- Hash do arquivo (SHA-256 por exemplo)
    created_at DATE DEFAULT CURRENT_DATE,             -- Data de criação (somente a data, sem hora)
    processed_at DATE,                                -- Data de processamento (somente a data)
    status VARCHAR(20) DEFAULT 'pendente',            -- Status do arquivo (pendente, processado, erro)
    source VARCHAR(255),                              -- Fonte de onde o arquivo veio (opcional)
    file_type VARCHAR(20),                            -- Tipo do arquivo (ex.: txt, csv, json)
    file_description TEXT,                            -- Descrição opcional do arquivo
    processed_entries_count INT DEFAULT 0             -- Contagem de entradas processadas (para auditoria)
);

-- Adicionando índices para otimizar as buscas
CREATE INDEX IF NOT EXISTS idx_file_logs_file_hash ON file_logs(file_hash);
CREATE INDEX IF NOT EXISTS idx_file_logs_status ON file_logs(status);
CREATE INDEX IF NOT EXISTS idx_file_logs_created_at ON file_logs(created_at);

CREATE TABLE log_entries (
    id SERIAL PRIMARY KEY,                           -- Identificador único da entrada de log
    file_log_id INT NOT NULL,                         -- Chave estrangeira para o arquivo de log (tabela file_logs)
    url TEXT,                                 -- URL extraída do log
    username TEXT,                            -- Nome de usuário extraído do log
    password TEXT,                                    -- Senha extraída do log
    log_data TEXT,                                    -- Texto bruto da entrada do log
    created_at DATE DEFAULT CURRENT_DATE,             -- Data de criação da entrada de log (somente a data)
    processed_at DATE,                                -- Data de quando a entrada foi processada (somente a data)
    FOREIGN KEY (file_log_id) REFERENCES file_logs(id)  -- Relacionamento com a tabela file_logs
);

-- Adicionando índices para otimizar as buscas
CREATE INDEX IF NOT EXISTS idx_log_entries_file_log_id ON log_entries(file_log_id);
CREATE INDEX IF NOT EXISTS idx_log_entries_created_at ON log_entries(created_at);

